version: 1.0
runtime: python311
build:
  commands:
    build:
      - pip3 install --upgrade pip
run:
  runtime-version: 3.11
  pre-run:
    - pip3 install -r requirements.txt
  command: gunicorn app:app --log-file - --worker-class gevent
  network:
    port: 8080
    health-check:
      healthy-threshold: 1
      unhealthy-threshold: 5
      interval: 10
      timeout: 5
      path: /api/healthz
      protocol: HTTP
  env:
    # Application configuration
    - name: FLASK_ENV
      value: "production"
    - name: FLASK_DEBUG
      value: "false"
    
    # CORS configuration for production
    - name: ALLOWED_ORIGINS
      value: "https://your-domain.com"
    
    # Default scoring weights (can be overridden via UI)
    - name: DEFAULT_WEIGHTS
      value: '{"total_cost": 0.4, "total_time": 0.3, "reliability": 0.2, "capacity": 0.1}'
  
  # Secrets from AWS Secrets Manager or Systems Manager Parameter Store
  secrets:
    # Notion API credentials
    - name: NOTION_API_KEY
      value-from: "arn:aws:secretsmanager:us-east-2:274921264674:secret:synseer/notion-api-key"
    
    # Notion database IDs
    - name: VENDORS_DB_ID
      value-from: "arn:aws:secretsmanager:us-east-2:274921264674:secret:synseer/vendors-db-id"
    
    - name: PARTS_DB_ID
      value-from: "arn:aws:secretsmanager:us-east-2:274921264674:secret:synseer/parts-db-id"
    
    - name: SCORES_DB_ID
      value-from: "arn:aws:secretsmanager:us-east-2:274921264674:secret:synseer/scores-db-id"
    
    # Application secret key
    - name: SECRET_KEY
      value-from: "arn:aws:secretsmanager:us-east-2:274921264674:secret:synseer/flask-secret-key"